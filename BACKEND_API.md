# Azoth Path åç«¯ API æ–‡æ¡£

**é¡¹ç›®åç§°ï¼š** Azoth Path - æ— å°½åˆæˆå·¥å…·ç«™
**åç«¯åœ°å€ï¼š** http://localhost:19198
**æ•°æ®åº“ï¼š** SQLite (WAL æ¨¡å¼)
**è®¤è¯æ–¹å¼ï¼š** Bearer Token (JWT)
**æ—¶åŒºï¼š** UTC+8 (Asia/Shanghai)

---

## ç›®å½•

1. [ç³»ç»Ÿå¥åº·æ£€æŸ¥](#ç³»ç»Ÿå¥åº·æ£€æŸ¥)
2. [ç”¨æˆ·ç®¡ç† API](#ç”¨æˆ·ç®¡ç†-api)
3. [é…æ–¹ç®¡ç† API](#é…æ–¹ç®¡ç†-api)
4. [ä»»åŠ¡ç®¡ç† API](#ä»»åŠ¡ç®¡ç†-api)
5. [æ‰¹é‡å¯¼å…¥ API](#æ‰¹é‡å¯¼å…¥-api)
6. [ç‰©å“ç®¡ç† API](#ç‰©å“ç®¡ç†-api)
7. [æ ‡ç­¾ç®¡ç† API](#æ ‡ç­¾ç®¡ç†-api)
8. [ç³»ç»Ÿç›‘æ§ API](#ç³»ç»Ÿç›‘æ§-api)
9. [é€šç”¨ä¿¡æ¯](#é€šç”¨ä¿¡æ¯)

---

## é€šç”¨å“åº”æ ¼å¼

æ‰€æœ‰APIå“åº”éƒ½éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... }
}
```

**çŠ¶æ€ç è¯´æ˜ï¼š**
- `200`: æˆåŠŸ
- `201`: åˆ›å»ºæˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªæˆæƒ
- `403`: æƒé™ä¸è¶³
- `404`: èµ„æºä¸å­˜åœ¨
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

## ç³»ç»Ÿå¥åº·æ£€æŸ¥

### GET /health
è·å–æœåŠ¡å™¨å¥åº·çŠ¶æ€

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "ok",
  "message": "Server is running",
  "timestamp": "2025-10-19T13:31:20.248Z",
  "timezone": "Asia/Shanghai (UTC+8)",
  "uptime": 438.118606129
}
```

---

## ç”¨æˆ·ç®¡ç† API

### POST /api/users/register
ç”¨æˆ·æ³¨å†Œ

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "username": "string",  // 3-20ä¸ªå­—ç¬¦
  "password": "string"   // è‡³å°‘6ä¸ªå­—ç¬¦
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 201,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "id": 1,
    "username": "testuser",
    "auth": 1,
    "contribute": 0,
    "created_at": "2025-10-19T13:31:20.248Z"
  }
}
```

---

### POST /api/users/login
ç”¨æˆ·ç™»å½•

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "username": "string",
  "password": "string"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "testuser",
      "auth": 1,
      "contribute": 0
    }
  }
}
```

---

### GET /api/users/me
è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è®¤è¯æ–¹å¼ï¼š** Bearer Token
```
Authorization: Bearer <your_jwt_token>
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": 1,
    "username": "testuser",
    "auth": 1,
    "contribute": 100,
    "created_at": "2025-10-19T13:31:20.248Z"
  }
}
```

---

### GET /api/users/:id
è·å–ç‰¹å®šç”¨æˆ·ä¿¡æ¯ï¼ˆå…¬å¼€ä¿¡æ¯ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç”¨æˆ·ID

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": 1,
    "username": "testuser",
    "auth": 1,
    "contribute": 100
  }
}
```

---

### GET /api/users/contribution-rank
è·å–è´¡çŒ®æ’è¡Œæ¦œ

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "users": [
      {
        "id": 1,
        "username": "testuser",
        "contribute": 100,
        "rank": 1
      }
    ],
    "total": 1,
    "page": 1,
    "limit": 10
  }
}
```

---

### GET /api/users/:id/stats
è·å–ç”¨æˆ·è¯¦ç»†è´¡çŒ®ç»Ÿè®¡

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç”¨æˆ·ID

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "user_id": 1,
    "total_contribute": 100,
    "recipes_count": 5,
    "tasks_completed": 2,
    "likes_received": 10
  }
}
```

---

### GET /api/users/:id/liked-recipes
è·å–ç”¨æˆ·ç‚¹èµçš„é…æ–¹åˆ—è¡¨

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç”¨æˆ·ID

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰

---

### GET /api/users/admin/list
è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

**è®¤è¯è¦æ±‚ï¼š** éœ€è¦ç®¡ç†å‘˜æƒé™ï¼ˆauth=9ï¼‰

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `search`: æœç´¢å…³é”®è¯
- `role`: è§’è‰²ç­›é€‰

---

### PUT /api/users/admin/:id/role
æ›´æ–°ç”¨æˆ·æƒé™ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

**è®¤è¯è¦æ±‚ï¼š** éœ€è¦ç®¡ç†å‘˜æƒé™

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "role": 1 æˆ– 9  // 1: æ™®é€šç”¨æˆ·, 9: ç®¡ç†å‘˜
}
```

---

### PUT /api/users/admin/:id
æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

**è®¤è¯è¦æ±‚ï¼š** éœ€è¦ç®¡ç†å‘˜æƒé™

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "name": "string",        // å¯é€‰
  "contribute": number,    // å¯é€‰
  "level": number,         // å¯é€‰
  "auth": number,          // å¯é€‰
  "created_at": "string"   // å¯é€‰
}
```

---

### DELETE /api/users/admin/:id
åˆ é™¤ç”¨æˆ·ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

**è®¤è¯è¦æ±‚ï¼š** éœ€è¦ç®¡ç†å‘˜æƒé™

---

### GET /api/users/admin/count
è·å–ç”¨æˆ·æ€»æ•°ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

**è®¤è¯è¦æ±‚ï¼š** éœ€è¦ç®¡ç†å‘˜æƒé™

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total_users": 100
  }
}
```

---

## é…æ–¹ç®¡ç† API

### GET /api/recipes
è·å–é…æ–¹åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `search`: æœç´¢å…³é”®è¯
- `orderBy`: æ’åºå­—æ®µï¼ˆcreated_at, likesç­‰ï¼‰
- `result`: æŒ‰ç»“æœç­›é€‰
- `cursor`: æ¸¸æ ‡åˆ†é¡µï¼ˆç”¨äºå¤§æ•°æ®é‡ï¼‰
- `includePrivate`: æ˜¯å¦åŒ…å«æœªå…¬å¼€æ•°æ®ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼Œé»˜è®¤1ï¼‰
- `includeStats`: æ˜¯å¦åŒ…å«ç»Ÿè®¡ä¿¡æ¯ï¼ˆé»˜è®¤0ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "recipes": [
      {
        "id": 1,
        "item_a": "ç«",
        "item_b": "æ°´",
        "result": "è’¸æ±½",
        "likes": 5,
        "created_at": "2025-10-19T13:31:20.248Z",
        "is_liked": false
      }
    ],
    "total": 100,
    "page": 1,
    "limit": 20
  }
}
```

---

---

### GET /api/recipes/:id
è·å–é…æ–¹è¯¦æƒ…

**è·¯å¾„å‚æ•°ï¼š**
- `id`: é…æ–¹ID

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": 1,
    "item_a": "ç«",
    "item_b": "æ°´",
    "result": "è’¸æ±½",
    "likes": 5,
    "created_at": "2025-10-19T13:31:20.248Z",
    "is_liked": false,
    "user": {
      "id": 1,
      "username": "testuser"
    }
  }
}
```

---

### POST /api/recipes/submit
æäº¤é…æ–¹ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "item_a": "string",    // ç‰©å“Aåç§°
  "item_b": "string",    // ç‰©å“Båç§°
  "result": "string"     // åˆæˆç»“æœ
}
```

**éªŒè¯è§„åˆ™ï¼š**
- ç‰©å“åç§°é•¿åº¦ä¸è¶…è¿‡50ä¸ªå­—ç¬¦
- åªèƒ½åŒ…å«ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ç©ºæ ¼ã€è¿å­—ç¬¦å’Œä¸‹åˆ’çº¿

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 201,
  "message": "æäº¤æˆåŠŸ",
  "data": {
    "id": 1
  }
}
```

---

### POST /api/recipes/:id/like
ç‚¹èµ/å–æ¶ˆç‚¹èµé…æ–¹ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: é…æ–¹ID

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "ç‚¹èµæˆåŠŸ",
  "data": {
    "liked": true,
    "likes_count": 6
  }
}
```

---

### PUT /api/recipes/:id/public
æ›´æ–°é…æ–¹å…¬å¼€çŠ¶æ€ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: é…æ–¹ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "is_public": 0 æˆ– 1  // 0: æœªå…¬å¼€, 1: å…¬å¼€
}
```

---

### GET /api/recipes/path/:item
æœç´¢åˆæˆè·¯å¾„

**è·¯å¾„å‚æ•°ï¼š**
- `item`: ç‰©å“åç§°ï¼ˆéœ€è¦URLç¼–ç ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "item": "è’¸æ±½",
    "path": [
      {
        "step": 1,
        "item_a": "ç«",
        "item_b": "æ°´",
        "result": "è’¸æ±½"
      }
    ]
  }
}
```

---

### GET /api/recipes/shortest-path/:item
è·å–å•ä¸ªç‰©å“çš„æœ€çŸ­è·¯å¾„æ ‘

**è·¯å¾„å‚æ•°ï¼š**
- `item`: ç‰©å“åç§°ï¼ˆéœ€è¦URLç¼–ç ï¼‰

---

### GET /api/recipes/graph/stats
è·å–å›¾ç»Ÿè®¡ä¿¡æ¯

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total_recipes": 1000,
    "total_items": 500,
    "reachable_items": 450,
    "unreachable_items": 50
  }
}
```

---

### GET /api/recipes/batch
æ‰¹é‡è·å–é…æ–¹ï¼ˆç”¨äºå¤§æ•°æ®é‡åœºæ™¯ï¼‰

**æŸ¥è¯¢å‚æ•°ï¼š**
- `batchSize`: æ‰¹æ¬¡å¤§å°ï¼ˆé»˜è®¤1000ï¼‰
- `lastId`: ä¸Šæ¬¡è·å–çš„æœ€åä¸€ä¸ªID
- `search`: æœç´¢å…³é”®è¯

---

---

### GET /api/recipes/icicle-chart/on-demand/:item
æŒ‰éœ€ç”ŸæˆæŒ‡å®šç‰©å“çš„å†°æŸ±å›¾

**è·¯å¾„å‚æ•°ï¼š**
- `item`: ç‰©å“åç§°ï¼ˆéœ€è¦URLç¼–ç ï¼‰

**æŸ¥è¯¢å‚æ•°ï¼š**
- `maxDepth`: æœ€å¤§æ·±åº¦é™åˆ¶ï¼ˆå¯é€‰ï¼‰
- `includeStats`: æ˜¯å¦åŒ…å«ç»Ÿè®¡ä¿¡æ¯ï¼ˆtrue/falseï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "æŒ‰éœ€ç”Ÿæˆå†°æŸ±å›¾æˆåŠŸ",
  "data": {
    "nodes": [...],
    "links": [...]
  },
  "responseTime": 150,
  "metadata": {
    "maxDepth": "ä¸é™åˆ¶",
    "nodeCount": 25
  }
}
```

---

### GET /api/recipes/reachability/:item
è·å–å…ƒç´ çš„å¯è¾¾æ€§ç»Ÿè®¡ä¿¡æ¯

**è·¯å¾„å‚æ•°ï¼š**
- `item`: ç‰©å“åç§°ï¼ˆéœ€è¦URLç¼–ç ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–å…ƒç´ å¯è¾¾æ€§ç»Ÿè®¡æˆåŠŸ",
  "data": {
    "item": "è’¸æ±½",
    "reachable_count": 10,
    "unreachable_count": 5,
    "total_items": 15,
    "reachability_percentage": 66.7
  },
  "responseTime": 50
}
```

---

---

## ä»»åŠ¡ç®¡ç† API

### GET /api/tasks
è·å–ä»»åŠ¡åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡
- `status`: ä»»åŠ¡çŠ¶æ€ï¼ˆactive, completedï¼‰
- `sortBy`: æ’åºå­—æ®µï¼ˆcreated_at, prizeï¼‰
- `sortOrder`: æ’åºé¡ºåºï¼ˆasc, descï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "tasks": [
      {
        "id": 1,
        "item_name": "é’»çŸ³",
        "prize": 100,
        "status": "active",
        "created_at": "2025-10-19T13:31:20.248Z",
        "completed_at": null
      }
    ],
    "total": 10,
    "page": 1,
    "limit": 20
  }
}
```

---

### GET /api/tasks/stats
è·å–ä»»åŠ¡ç»Ÿè®¡

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "total": 100,
    "active": 50,
    "completed": 50,
    "total_prize": 5000
  }
}
```

---

### GET /api/tasks/:id
è·å–ä»»åŠ¡è¯¦æƒ…

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ä»»åŠ¡ID

---

### POST /api/tasks
åˆ›å»ºä»»åŠ¡ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "itemName": "string",  // ç‰©å“åç§°
  "prize": 100          // å¥–åŠ±åˆ†æ•°ï¼ˆæ™®é€šç”¨æˆ·è‡ªåŠ¨ä¸º0ï¼Œç®¡ç†å‘˜å¯è®¾ç½®0-200ï¼‰
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 201,
  "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
  "data": {
    "taskId": 1
  }
}
```

---

### POST /api/tasks/:id/complete
å®Œæˆä»»åŠ¡ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ä»»åŠ¡ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "recipeId": 1  // é…æ–¹ID
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "ğŸ‰ ä»»åŠ¡å®Œæˆï¼è·å¾— 100 è´¡çŒ®åˆ†",
  "data": {
    "task_id": 1,
    "recipe_id": 1,
    "prize": 100,
    "user_contribute": 200
  }
}
```

---

### PATCH /api/tasks/:id
æ›´æ–°ä»»åŠ¡æ‚¬èµï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ä»»åŠ¡ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "prize": 100  // å¥–åŠ±åˆ†æ•°ï¼ˆ0-200ï¼‰
}
```

---

### DELETE /api/tasks/:id
åˆ é™¤ä»»åŠ¡ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ä»»åŠ¡ID

---

## æ‰¹é‡å¯¼å…¥ API

### POST /api/import-tasks/batch
æ‰¹é‡å¯¼å…¥é…æ–¹ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "text": "ç«+æ°´=è’¸æ±½\nåœŸ+æ°´=æ³¥æµ†\n..."
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 201,
  "message": "æ‰¹é‡å¯¼å…¥å·²å¼€å§‹ï¼Œè¯·æŸ¥çœ‹é€šçŸ¥é¢æ¿äº†è§£è¿›åº¦",
  "data": {
    "taskId": 1,
    "totalCount": 10
  }
}
```

---

### GET /api/import-tasks
è·å–ç”¨æˆ·çš„å¯¼å…¥ä»»åŠ¡åˆ—è¡¨ï¼ˆéœ€è¦è®¤è¯ï¼‰

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `status`: ä»»åŠ¡çŠ¶æ€ç­›é€‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "tasks": [
      {
        "id": 1,
        "user_id": 1,
        "status": "processing",
        "total_count": 10,
        "success_count": 5,
        "error_count": 2,
        "created_at": "2025-10-19T13:31:20.248Z"
      }
    ],
    "total": 1,
    "page": 1,
    "limit": 20
  }
}
```

---

### GET /api/import-tasks/:id
è·å–å¯¼å…¥ä»»åŠ¡è¯¦æƒ…ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: å¯¼å…¥ä»»åŠ¡ID

---

### GET /api/import-tasks/:id/contents
è·å–å¯¼å…¥ä»»åŠ¡æ˜ç»†ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: å¯¼å…¥ä»»åŠ¡ID

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `status`: å†…å®¹çŠ¶æ€ç­›é€‰

---

### GET /api/import-tasks/validation-status
è·å–éªŒè¯é˜Ÿåˆ—çŠ¶æ€ï¼ˆéœ€è¦è®¤è¯ï¼‰

---

### DELETE /api/import-tasks/:id/notification
åˆ é™¤å¯¼å…¥ä»»åŠ¡é€šçŸ¥ï¼ˆéœ€è¦è®¤è¯ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: å¯¼å…¥ä»»åŠ¡ID

---

### GET /api/import-tasks/unread-completed
è·å–ç”¨æˆ·æœªè¯»çš„å·²å®Œæˆä»»åŠ¡ï¼ˆéœ€è¦è®¤è¯ï¼‰

---

## ç‰©å“ç®¡ç† API

### GET /api/items
è·å–ç‰©å“åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `length`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰âš ï¸ æ³¨æ„ï¼šå‚æ•°åä¸º `length` è€Œé `limit`
- `search`: æœç´¢å…³é”®è¯
- `type`: ç‰©å“ç±»å‹ï¼ˆbase, synthetic, ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºå…¨éƒ¨ï¼‰
- `sortBy`: æ’åºå­—æ®µï¼ˆid, name, usage_countï¼‰
- `sortOrder`: æ’åºé¡ºåºï¼ˆasc, descï¼‰
- `exact`: ç²¾ç¡®åŒ¹é…ï¼ˆtrue/falseï¼‰
- `includePrivate`: æ˜¯å¦åŒ…å«æœªå…¬å¼€æ•°æ®ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "name": "é‡‘",
        "emoji": "ğŸ¥‡",
        "is_base": 1,
        "usage_count": 5,
        "recipe_count": 2
      }
    ],
    "total": 100,
    "page": 1,
    "limit": 20
  }
}
```

---

### GET /api/items/random
è·å–éšæœºç‰©å“

**æŸ¥è¯¢å‚æ•°ï¼š**
- `type`: ç‰©å“ç±»å‹ï¼ˆé»˜è®¤ synthetic åˆæˆå…ƒç´ ï¼‰
  - `synthetic`: åˆæˆå…ƒç´ 
  - `base`: åŸºç¡€å…ƒç´ 

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": 1,
    "name": "é‡‘",
    "emoji": "ğŸ¥‡",
    "is_base": 1,
    "usage_count": 5,
    "recipe_count": 2
  }
}
```

**æ³¨æ„ï¼š** æ­¤ç«¯ç‚¹å¿…é¡»åœ¨ `/:id` ä¹‹å‰è®¿é—®ï¼Œå¦åˆ™ 'random' ä¼šè¢«å½“ä½œ ID å¤„ç†

---

### GET /api/items/:id
è·å–å•ä¸ªç‰©å“è¯¦æƒ…

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç‰©å“ID

---

### PUT /api/items/:id/public
æ›´æ–°ç‰©å“å…¬å¼€çŠ¶æ€ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç‰©å“ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "is_public": 0 æˆ– 1  // 0: æœªå…¬å¼€, 1: å…¬å¼€
}
```

---

## æ ‡ç­¾ç®¡ç† API

### GET /api/tags
è·å–æ‰€æœ‰æ ‡ç­¾

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "tags": [
      {
        "id": 1,
        "name": "åŸºç¡€å…ƒç´ ",
        "description": "åŸºç¡€äº”å…ƒç´ ",
        "color": "#FF0000"
      }
    ]
  }
}
```

---

### GET /api/tags/:id
è·å–æ ‡ç­¾è¯¦æƒ…

**è·¯å¾„å‚æ•°ï¼š**
- `id`: æ ‡ç­¾ID

---

### POST /api/tags
åˆ›å»ºæ ‡ç­¾ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "name": "string",          // æ ‡ç­¾åç§°
  "description": "string",   // æè¿°ï¼ˆå¯é€‰ï¼‰
  "color": "string"          // é¢œè‰²ï¼ˆå¯é€‰ï¼‰
}
```

---

### PATCH /api/tags/:id
æ›´æ–°æ ‡ç­¾ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: æ ‡ç­¾ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "name": "string",          // å¯é€‰
  "description": "string",   // å¯é€‰
  "color": "string"          // å¯é€‰
}
```

---

### DELETE /api/tags/:id
åˆ é™¤æ ‡ç­¾ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: æ ‡ç­¾ID

---

### GET /api/tags/:id/items
è·å–æ‹¥æœ‰æŒ‡å®šæ ‡ç­¾çš„æ‰€æœ‰ç‰©å“

**è·¯å¾„å‚æ•°ï¼š**
- `id`: æ ‡ç­¾ID

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡

---

### POST /api/items/:id/tags
ä¸ºç‰©å“æ·»åŠ æ ‡ç­¾ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç‰©å“ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "tagId": 1  // æ ‡ç­¾ID
}
```

---

### DELETE /api/items/:id/tags/:tagId
ä»ç‰©å“ç§»é™¤æ ‡ç­¾ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç‰©å“ID
- `tagId`: æ ‡ç­¾ID

---

### PUT /api/items/:id/tags
æ‰¹é‡è®¾ç½®ç‰©å“æ ‡ç­¾ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç‰©å“ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "tagIds": [1, 2, 3]  // æ ‡ç­¾IDæ•°ç»„
}
```

---

### GET /api/items/:id/tags
è·å–ç‰©å“çš„æ‰€æœ‰æ ‡ç­¾

**è·¯å¾„å‚æ•°ï¼š**
- `id`: ç‰©å“ID

---

## ç³»ç»Ÿç›‘æ§ API

### GET /api/system/info
è·å–ç³»ç»Ÿä¿¡æ¯

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–ç³»ç»Ÿä¿¡æ¯æˆåŠŸ",
  "data": {
    "cpu": {
      "usage": 0.1,
      "cores": 4,
      "model": "Intel(R) Celeron(R) N5095A @ 2.00GHz"
    },
    "memory": {
      "total": 16295723008,
      "used": 12172926976,
      "free": 4122796032,
      "cached": 0,
      "usage": 74.7
    },
    "disk": {
      "total": 500363689984,
      "used": 26843545600,
      "free": 473520144384,
      "usage": 5,
      "path": "/qy/AzothPath"
    },
    "os": {
      "platform": "linux",
      "version": "4.18.0-553.5.1.el8.x86_64",
      "arch": "x64",
      "hostname": "qingying-peixi"
    },
    "node": {
      "version": "v22.15.0",
      "uptime": 82.081620041
    },
    "uptime": 32.4,
    "startTime": "2025-10-18T05:13:31.546Z"
  }
}
```

---

### GET /api/system/backup/status
è·å–æ•°æ®åº“å¤‡ä»½çŠ¶æ€

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–å¤‡ä»½çŠ¶æ€æˆåŠŸ",
  "data": {
    "backups": [
      {
        "name": "azothpath_backup_20251019.db",
        "size": 1024000,
        "sizeFormatted": "1.00 MB",
        "createdAt": "2025-10-19T13:31:20.248Z"
      }
    ]
  }
}
```

---

### POST /api/system/backup/manual
æ‰‹åŠ¨è§¦å‘æ•°æ®åº“å¤‡ä»½

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "å¤‡ä»½æˆåŠŸ",
  "data": {
    "backupPath": "/qy/AzothPath/database/backups/azothpath_backup_20251019.db",
    "timestamp": "2025-10-19T13:31:20.248Z"
  }
}
```

---

### GET /api/system/cache/status
è·å–å›¾ç¼“å­˜çŠ¶æ€

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–ç¼“å­˜çŠ¶æ€æˆåŠŸ",
  "data": {
    "hasGraphCache": true,
    "graphCacheAge": 15000,
    "ttl": 3600,
    "graphLastUpdatedFormatted": "2025-10-19T13:31:20.248Z",
    "graphAgeFormatted": "4å°æ—¶10åˆ†é’Ÿ15ç§’"
  }
}
```

---

### POST /api/system/cache/refresh
æ‰‹åŠ¨åˆ·æ–°å›¾ç¼“å­˜

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "ç¼“å­˜åˆ·æ–°æˆåŠŸ",
  "data": {
    "hasGraphCache": true,
    "graphCacheAge": 0
  }
}
```

---

## é€šç”¨ä¿¡æ¯

### API é¦–é¡µ
**GET /api**

è¿”å›APIåŸºæœ¬ä¿¡æ¯å’Œå¯ç”¨ç«¯ç‚¹åˆ—è¡¨

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "message": "Azoth Path API",
  "version": "1.0.0",
  "endpoints": {
    "recipes": "/api/recipes",
    "users": "/api/users",
    "tasks": "/api/tasks",
    "imports": "/api/import-tasks",
    "items": "/api/items",
    "tags": "/api/tags"
  }
}
```

---

## è®¤è¯è¯´æ˜

å¤§éƒ¨åˆ†APIéœ€è¦JWTè®¤è¯ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ï¼š

```
Authorization: Bearer <your_jwt_token>
```

### ç”¨æˆ·æƒé™çº§åˆ«

- `auth = 1`: æ™®é€šç”¨æˆ·
- `auth = 9`: ç®¡ç†å‘˜

### Tokenè·å–

é€šè¿‡ `POST /api/users/login` è·å–tokenï¼Œåœ¨ç™»å½•æˆåŠŸçš„å“åº”ä¸­è·å¾—ã€‚

---

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

- **400**: è¯·æ±‚å‚æ•°é”™è¯¯
  - ç”¨æˆ·åæˆ–å¯†ç ä¸ºç©º
  - é…æ–¹å‚æ•°ä¸å®Œæ•´
  - ç‰©å“åç§°é•¿åº¦è¶…é™
  - å­—ç¬¦ç™½åå•éªŒè¯å¤±è´¥

- **401**: æœªæˆæƒ
  - Tokenæ— æ•ˆæˆ–è¿‡æœŸ
  - ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

- **403**: æƒé™ä¸è¶³
  - éœ€è¦ç®¡ç†å‘˜æƒé™
  - æ²¡æœ‰æƒé™æŸ¥çœ‹èµ„æº

- **404**: èµ„æºä¸å­˜åœ¨
  - ç”¨æˆ·ä¸å­˜åœ¨
  - é…æ–¹ä¸å­˜åœ¨
  - ä»»åŠ¡ä¸å­˜åœ¨

- **500**: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  - æ•°æ®åº“è¿æ¥å¤±è´¥
  - ç³»ç»Ÿé”™è¯¯

### é”™è¯¯å“åº”ç¤ºä¾‹

```json
{
  "code": 400,
  "message": "ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º"
}
```

---

## é™æµç­–ç•¥

ç³»ç»Ÿå®ç°äº†å¤šçº§é™æµä¿æŠ¤ï¼š

1. **ä¸¥æ ¼é™æµ**: é…æ–¹æäº¤ç­‰æ•æ„Ÿæ“ä½œ
2. **ä¸€èˆ¬é™æµ**: ç‚¹èµã€ä»»åŠ¡åˆ›å»ºç­‰æ“ä½œ
3. **ä»»åŠ¡åˆ›å»ºé™æµ**: ä»»åŠ¡åˆ›å»ºä¸“ç”¨é™æµ
4. **éªŒè¯é™æµ**: æ‰¹é‡å¯¼å…¥éªŒè¯ä¸“ç”¨é™æµ

---

## æ•°æ®æ ¼å¼è¯´æ˜

### æ—¶é—´æ ¼å¼
æ‰€æœ‰æ—¶é—´å­—æ®µéƒ½ä½¿ç”¨UTC+8æ—¶åŒºï¼Œæ ¼å¼ä¸ºISO 8601ï¼š
```
2025-10-19T13:31:20.248Z
```

### åˆ†é¡µæ ¼å¼
æ‰€æœ‰åˆ†é¡µæ¥å£éƒ½ä½¿ç”¨ç»Ÿä¸€æ ¼å¼ï¼š
```json
{
  "data": [...],
  "total": 100,
  "page": 1,
  "limit": 20
}
```

### é…æ–¹æ ¼å¼
æ‰¹é‡å¯¼å…¥é…æ–¹æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š
```
A+B=C
ç‰©å“A+ç‰©å“B=ç»“æœç‰©å“
```
