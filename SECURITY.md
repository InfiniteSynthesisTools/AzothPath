# AzothPath 安全配置指南

## 概述

本文档记录了 AzothPath 项目的安全配置和最佳实践，确保应用程序在生产环境中的安全性。

## 已实施的安全修复

### 🔴 严重安全问题修复

1. **JWT 密钥配置**
   - **问题**: 硬编码默认密钥
   - **修复**: 使用环境变量 `JWT_SECRET` 配置
   - **位置**: `backend/src/middlewares/auth.ts`
   - **生产环境要求**: 必须设置强密码作为 JWT_SECRET

2. **默认管理员账户**
   - **问题**: 存在默认管理员账户 `admin`，密码 `admin123`
   - **修复**: 生产环境必须删除或修改默认账户
   - **位置**: `database/init.sql`

### 🟡 中等安全问题修复

3. **输入验证增强**
   - **问题**: 缺乏输入验证和长度限制
   - **修复**: 添加长度限制（50字符）和字符白名单验证
   - **位置**: `backend/src/routes/recipeRoutes.ts`
   - **验证规则**: 只允许中文、英文、数字、空格、连字符和下划线

4. **SQL 查询参数化**
   - **问题**: 动态 SQL 构建存在潜在注入风险
   - **修复**: 使用白名单验证 `orderBy` 参数
   - **位置**: `backend/src/services/recipeService.ts`

### 🟢 轻微安全问题修复

5. **错误信息处理**
   - **问题**: 错误信息泄露内部实现细节
   - **修复**: 使用通用错误消息，记录详细错误到日志
   - **位置**: 多个路由文件

## 环境变量配置

创建 `.env` 文件（基于 `.env.example`）：

```env
# JWT 密钥（生产环境必须设置强密码）
JWT_SECRET=your_secure_jwt_secret_key_here

# 数据库路径（可选，默认使用 database/azothpath.db）
DB_PATH=database/azothpath.db

# 后端端口（可选，默认 3000）
PORT=3000

# 前端端口（可选，默认 5173）
VITE_PORT=5173

# 生产环境配置
NODE_ENV=production
```

## 生产环境部署检查清单

### 部署前检查
- [ ] 设置强密码的 JWT_SECRET 环境变量
- [ ] 删除或修改默认管理员账户
- [ ] 配置生产环境数据库路径
- [ ] 启用 HTTPS
- [ ] 配置适当的 CORS 设置
- [ ] 设置防火墙规则

### 运行时安全
- [ ] 定期更新依赖包
- [ ] 监控错误日志
- [ ] 实施速率限制
- [ ] 定期备份数据库

## 安全最佳实践

### 1. 认证和授权
- 使用强密码策略
- 实施会话超时
- 使用 HTTPS 传输敏感数据

### 2. 数据验证
- 对所有用户输入进行验证
- 使用参数化查询防止 SQL 注入
- 实施适当的长度和类型限制

### 3. 错误处理
- 不向用户泄露敏感错误信息
- 记录详细的错误日志用于调试
- 使用统一的错误响应格式

### 4. 依赖管理
- 定期更新依赖包
- 使用安全扫描工具检查漏洞
- 移除未使用的依赖

## 紧急响应

如果发现安全漏洞：
1. 立即隔离受影响的系统
2. 评估漏洞影响范围
3. 实施临时修复措施
4. 通知相关用户
5. 部署永久修复

## 联系信息

如有安全问题，请联系项目维护者。

---

**最后更新**: 2025-10-19
**版本**: 1.0
